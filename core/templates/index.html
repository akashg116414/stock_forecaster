{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<div class="main-content-container container-fluid px-4">
    <!-- Page Header -->
    <div class="page-header row no-gutters py-4">
      <div class="col-12 col-sm-4 text-center text-sm-left mb-0">
        <span class="text-uppercase page-subtitle">Dashboard</span>
        <h3 class="page-title">Stock Analytic Dashboard</h3>
      </div>
    </div>
    <!-- End Page Header -->
    <!-- Small Stats Blocks -->
    <div class="row">
      <div class="col-lg col-md-6 col-sm-6 mb-4">
        <div class="stats-small stats-small--1 card card-small">
          <div class="card-body p-0 d-flex">
            <div class="d-flex flex-column m-auto">
              <div class="stats-small__data text-center">
                <span class="stats-small__label text-uppercase">Nifty 50</span>
                <h6 class="stats-small__value count my-3">18010</h6>
              </div>
              <div class="stats-small__data">
                <span class="stats-small__percentage stats-small__percentage--increase">3.4%</span>
              </div>
            </div>
            <!-- <canvas height="120" class="blog-overview-stats-small-1"></canvas> -->
          </div>
        </div>
      </div>
      <div class="col-lg col-md-6 col-sm-6 mb-4">
        <div class="stats-small stats-small--1 card card-small">
          <div class="card-body p-0 d-flex">
            <div class="d-flex flex-column m-auto">
              <div class="stats-small__data text-center">
                <span class="stats-small__label text-uppercase">Sensex</span>
                <h6 class="stats-small__value count my-3">65003</h6>
              </div>
              <div class="stats-small__data">
                <span class="stats-small__percentage stats-small__percentage--increase">2.4%</span>
              </div>
            </div>
            <!-- <canvas height="120" class="blog-overview-stats-small-2"></canvas> -->
          </div>
        </div>
      </div>
      <div class="col-lg col-md-4 col-sm-6 mb-4">
        <div class="stats-small stats-small--1 card card-small">
          <div class="card-body p-0 d-flex">
            <div class="d-flex flex-column m-auto">
              <div class="stats-small__data text-center">
                <span class="stats-small__label text-uppercase">India Vix</span>
                <h6 class="stats-small__value count my-3">15.6</h6>
              </div>
              <div class="stats-small__data">
                <span class="stats-small__percentage stats-small__percentage--decrease">1.8%</span>
              </div>
            </div>
            <!-- <canvas height="120" class="blog-overview-stats-small-3"></canvas> -->
          </div>
        </div>
      </div>
      <div class="col-lg col-md-4 col-sm-6 mb-4">
        <div class="stats-small stats-small--1 card card-small">
          <div class="card-body p-0 d-flex">
            <div class="d-flex flex-column m-auto">
              <div class="stats-small__data text-center">
                <span class="stats-small__label text-uppercase">Bank Nifty</span>
                <h6 class="stats-small__value count my-3">42002</h6>
              </div>
              <div class="stats-small__data">
                <span class="stats-small__percentage stats-small__percentage--increase">4.4%</span>
              </div>
            </div>
            <!-- <canvas height="120" class="blog-overview-stats-small-4"></canvas> -->
          </div>
        </div>
      </div>
      <div class="col-lg col-md-4 col-sm-6 mb-4">
        <div class="stats-small stats-small--1 card card-small">
          <div class="card-body p-0 d-flex">
            <div class="d-flex flex-column m-auto">
              <div class="stats-small__data text-center">
                <span class="stats-small__label text-uppercase">Bank Nifty</span>
                <h6 class="stats-small__value count my-3">42002</h6>
              </div>
              <div class="stats-small__data">
                <span class="stats-small__percentage stats-small__percentage--increase">4.4%</span>
              </div>
            </div>
            <!-- <canvas height="120" class="blog-overview-stats-small-4"></canvas> -->
          </div>
        </div>
      </div>
      <div class="col-lg col-md-4 col-sm-12 mb-4">
        <div class="stats-small stats-small--1 card card-small">
          <div class="card-body p-0 d-flex">
            <div class="d-flex flex-column m-auto">
              <div class="stats-small__data text-center">
                <span class="stats-small__label text-uppercase">Fin Nifty</span>
                <h6 class="stats-small__value count my-3">19010</h6>
              </div>
              <div class="stats-small__data">
                <span class="stats-small__percentage stats-small__percentage--increase">3.4%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- End Small Stats Blocks -->
    <div class="row">
      <!-- Users Stats -->
      <div class="col-lg-8 col-md-12 col-sm-12 mb-4">
        <div class="card card-small">
          <div class="card-header border-bottom">
            <form method="get" action="{% url 'search' %}" class="main-navbar__search w-100 d-none d-md-flex d-lg-flex">
              <div class="input-group input-group-seamless ml-3">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <i class="fas fa-search"></i>
                  </div>
                </div>
                <input class="navbar-search form-control"type="text" name="q" id="search-input" value="{{ keyword }}" placeholder="Search for something..." aria-label="Search"> </div>
            </form>
            <div id="search-results" style="max-height: 100px; overflow: auto;"></div>
          </div>
          <div class="card-body pt-0">
            <div class="row border-bottom py-2 bg-light">
            
              <div class="input-daterange input-group" id="datepicker">

                <input type="text" class="input-sm form-control ml-3" id="start-date" name="start" placeholder="Start date">
                <input type="text" class="input-sm form-control" id="end-date" name="end" placeholder="End date">
              

              <div class="col-sm-3">
              <div class="dropdown">
                <button class="btn btn-md btn-white dropdown-toggle ml-auto mr-auto ml-sm-auto" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Interval
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  <h5 class="dropdown-header">Minutes</h5>
                  <a class="dropdown-item" href="#">1 min</a>
                  <a class="dropdown-item" href="#">5 min</a>
                  <a class="dropdown-item" href="#">30 min</a>
                  <h6 class="dropdown-header">Hour</h6>
                  <a class="dropdown-item" href="#">1 hour</a>
                  <h5 class="dropdown-header">Days</h5>
                  <a class="dropdown-item" href="#">1 day</a>
                  <a class="dropdown-item" href="#">5 day</a>
                  <a class="dropdown-item" href="#">1 week</a>
                  <a class="dropdown-item" href="#">1 month</a>
                  <a class="dropdown-item" href="#">3 month</a>
                </div>
              </div>
              </div>
             </div>
            </div>
            
           
              <canvas height="130" style="max-width: 100% !important;" class="blog-overview-users" id="blog-overview-users"></canvas>
         

          </div>
        </div>
      </div>
      <!-- End Users Stats -->
      <!-- Users By Device Stats -->
      <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
        <div class="card card-small h-100">
          <div class="card-header border-bottom">
            <h6 class="m-0">Global Indicators</h6>
          </div>
          <div class="card-body d-flex py-0">
              <div class="stats-small__data text">
                <span class="stats-small__label text-uppercase">Dollar</span>
                <h6 class="stats-small__value count my-3">84</h6>
              </div>
              <div class="stats-small__data">
                <span class="stats-small__percentage stats-small__percentage--increase">1.4%</span>
              </div>
            </div>
            <div class="card-body d-flex py-0">
              <div class="stats-small__data text">
                <span class="stats-small__label text-uppercase">Gold</span>
                <h6 class="stats-small__value count my-3">64021</h6>
              </div>
              <div class="stats-small__data">
                <span class="stats-small__percentage stats-small__percentage--increase">3.3%</span>
              </div>
          </div>
          <div class="card-body d-flex py-0">
            <div class="stats-small__data text">
              <span class="stats-small__label text-uppercase">Silver</span>
              <h6 class="stats-small__value count my-3">76041</h6>
            </div>
            <div class="stats-small__data">
              <span class="stats-small__percentage stats-small__percentage--increase">1.2%</span>
            </div>
        </div>
          <!-- <div class="card-footer border-top">
            <div class="row">
              <div class="col">
                <select class="custom-select custom-select-sm" style="max-width: 130px;">
                  <option selected>Last Week</option>
                  <option value="1">Today</option>
                  <option value="2">Last Month</option>
                  <option value="3">Last Year</option>
                </select>
              </div>
              <div class="col text-right view-report">
                <a href="#">Full report &rarr;</a>
              </div>
            </div>
          </div> -->
        </div>
      </div>
      </div>

      <div class="row">
        <!-- Users Stats -->
        <div class="col-lg-8 col-md-12 col-sm-12 mb-4">
          <div class="card card-small">
            <div class="card-header border-bottom">
              <form action="#" class="main-navbar__search w-100 d-none d-md-flex d-lg-flex">
                <div class="input-group input-group-seamless ml-3">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      <i class="fas fa-search"></i>
                    </div>
                  </div>
                  <input class="navbar-search form-control" type="text" placeholder="Search for something..." aria-label="Search"> </div>
              </form>
            </div>
            <div class="card-body pt-0">
              <div class="row border-bottom py-2 bg-light">
                <div class="col-12 col-sm-6">
                  <div id="blog-overview-date-range" class="input-daterange input-group input-group-sm my-auto ml-auto mr-auto ml-sm-auto mr-sm-0" style="max-width: 350px;">
                    <input type="text" class="input-sm form-control" name="start" placeholder="Start Date" id="blog-overview-date-range-1">
                    <input type="text" class="input-sm form-control" name="end" placeholder="End Date" id="blog-overview-date-range-2">
                    <span class="input-group-append">
                      <span class="input-group-text">
                        <i class="material-icons"></i>
                      </span>
                    </span>
                  </div>
                </div>
                <div class="col-12 col-sm-6 d-flex mb-2 mb-sm-0">
                  <button type="button" class="btn btn-sm btn-white ml-auto mr-auto ml-sm-auto mr-sm-0 mt-3 mt-sm-0">View Full Report &rarr;</button>
                </div>
              </div>
              <canvas height="130" style="max-width: 100% !important;" class="blog-overview-users1"></canvas>
            </div>
          </div>
        </div>
        </div>

      
      <!-- End Top Referrals Component -->
    </div>
 </div>
  


{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  searchInput.addEventListener('input', (event) => {
      const keyword = event.target.value;
      if (keyword) {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', `/search/?q=${keyword}`);
          xhr.onreadystatechange = () => {
              if (xhr.readyState === XMLHttpRequest.DONE) {
                  if (xhr.status === 200) {
                      const items = JSON.parse(xhr.responseText);
                      let html = '';
                      if (items.length > 0) {
                          html += '<p>';
                          for (const item of items) {
                              html += `<a href="?symbol=${item.symbol}" class="search-result">${item.name}</a></br>`;
                          }
                          html += '</p>';
                      }
                      else {
                          html += '<p>No Stocks found.</p>';
                      }
                      searchResults.innerHTML = html;
                  } else {
                      searchResults.innerHTML = 'Error';
                  }
              }
          };
          xhr.send();
      } else {
          searchResults.innerHTML = '';
      }
  });
  searchResults.addEventListener('click', (event) => {
      if (event.target.classList.contains('search-result')) {
          event.preventDefault();
          const href = event.target.getAttribute('href');
          window.location.href = href;
      }
  }); 
</script>

<script>
  $(document).ready(function() {
      // Initialize datepicker library on start and end date input fields
      $("#start-date").datepicker({
          dateFormat: "yy-mm-dd",
          onSelect: function() {
              // When a start date is selected, set the minDate option of the end date datepicker
              var startDate = $(this).datepicker("getDate");
              $("#end-date").datepicker("option", "minDate", startDate);
          }
      });
      $("#end-date").datepicker({
          dateFormat: "yy-mm-dd",
          onSelect: function() {
              // When an end date is selected, set the maxDate option of the start date datepicker
              var endDate = $(this).datepicker("getDate");
              $("#start-date").datepicker("option", "maxDate", endDate);
          }
      });

      // Add click handler to start and end date input fields to show the datepicker calendar
      $("#start-date, #end-date").on("click", function() {
          $(this).datepicker("show");
      });
  });

</script>
<!-- <script src="/static/assets/js/app/app-blog-overview.1.1.0.js"></script> -->

  
  <script>
    // Retrieve data from context variable 
    const labels= {{ dates|safe }};
    const values = {{ prices|safe }};
    var name = "{{stock_name}}";
    console.log(name);

    // const labels = dateList.map(date => date.toDateString());
    // Extract x and y values from data
    // const labels = data.map(item => item.x);
    // const values = data.map(item => item.y);

    // Create chart using Chart.js
    const ctx = document.getElementById('blog-overview-users').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: name,
          data: values,
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderColor: 'rgba(255, 99, 132, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            }
          }]
        }
      }
    });
  </script>



<style>
  .search-result {
      color: rgb(9, 9, 9);
      text-decoration: none;
      cursor: pointer;
  }

  .search-result:hover {
      text-decoration: underline;
  }
</style>

{% endblock javascripts %}
